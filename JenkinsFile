pipeline {
    agent any

    environment {
        REPO_URL = 'git@github.com:jfarrell720/MotherBaseStudiosWebsite.git' // Use SSH URL
        BRANCH = 'develop'
    }

    stages {
        stage('Clone Repository') {
            steps {
                git branch: "${BRANCH}",
                    credentialsId: 'GitHubSSHKey', // Use the SSH key stored in Jenkins credentials
                    url: "${REPO_URL}"
            }
        }

        stage('Build') {
            steps {
                echo 'No build step required for HTML. Proceeding to validation.'
            }
        }

        stage('Deploy to GitHub Pages') {
            steps {
                echo 'Starting deployment to GitHub Pages...'
                withCredentials([sshUserPrivateKey(credentialsId: 'GitHubSSHKey', keyFileVariable: 'SSH_KEY_PATH')]) {
                    sh '''
                        eval `ssh-agent -s`
                        ssh-add $SSH_KEY_PATH
                        
                        git config --global user.name "jfarrell720"
                        git config --global user.email "jamesfarrell720@gmail.com"
                        echo "Configured Git user..."
                        
                        git checkout -B gh-pages
                        echo "Checked out to gh-pages branch..."
                        
                        git add .
                        echo "Files added to staging..."
                        
                        git commit -m "Deploying to GitHub Pages"
                        echo "Commit made..."
                        
                        git push origin gh-pages --force --verbose
                        echo "Push complete."
                    '''
                }
            }
        }
    }

    post {
        success {
            echo 'Pipeline completed successfully!'
        }
        failure {
            echo 'Pipeline failed.'
        }
    }
}